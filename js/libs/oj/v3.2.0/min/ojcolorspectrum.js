/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","jquery","ojs/ojcomponentcore","ojs/ojcolor","ojs/ojslider","jqueryui-amd/widgets/draggable","ojs/ojtouchproxy","ojs/ojeditablevalue"],function(a,g,c){(function(){function b(a){var b;b=a.hD();var c=a.$C(),g=a.YC();b/=255;var c=c/255,g=g/255,k=Math.max(b,c,g),l=Math.min(b,c,g),m,p=(k+l)/2;if(k==l)m=l=0;else{var t=k-l,l=.5<p?t/(2-k-l):t/(k+l);switch(k){case b:m=(c-g)/t+(c<g?6:0);break;case c:m=(g-b)/t+2;break;case g:m=(b-c)/t+4}m/=6}b=[m,l,p];b[0]*=360;b[1]*=100;b[2]*=
100;b.push(a.XC());return b}a.ab("oj.ojColorSpectrum",c.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{value:null,rawValue:null,disabled:!1},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=null;switch(a.subId){case "oj-spectrum":b=this.Qm[0];break;case "oj-spectrum-thumb":b=this.ef[0];break;case "oj-hue-slider-bar":b=this.Ol.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-hue-slider-bar-value":b=this.Ol.ojSlider("getNodeBySubId",
{subId:"oj-slider-bar-value"});break;case "oj-hue-slider-thumb":b=this.Ol.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"});break;case "oj-opacity-slider-bar":b=this.Nl.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-opacity-slider-bar-value":b=this.Nl.ojSlider("getNodeBySubId",{subId:"oj-slider-bar-value"});break;case "oj-opacity-slider-thumb":b=this.Nl.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"})}return b},getSubIdByNode:function(a){if(!a)return null;a=c(a);var b=
null,f;a.hasClass("oj-colorspectrum-spectrum")?b="oj-spectrum":a.hasClass("oj-colorspectrum-thumb")?b="oj-spectrum-thumb":(f=a.closest(".oj-slider"),f=f.hasClass("oj-slider-vertical")?"hue":"opacity",a.hasClass("oj-slider-bar")?b="oj-"+f+"-slider-bar":a.hasClass("oj-slider-bar-value")?b="oj-"+f+"-slider-bar-value":a.hasClass("oj-slider-thumb")&&(b="oj-"+f+"-slider-thumb"));return{subId:b}},_destroy:function(){this.Sg&&(this.aza(),this.QAa(),this.kLa(),this.Sg.removeClass("oj-colorspectrum"),this.Ax());
this._super()},_ComponentCreate:function(){this._super();this.iHa()},Tg:function(){this._super();var b=this.cL();b?(b=b.attr("id"))?this.ef.attr("aria-labelledby",b):a.C.warn("JET Color Spectrum: The label for this component needs an id in order to be accessible"):(b=this.element.attr("aria-label"))&&this.ef.attr("aria-label",b)},_setOption:function(a,b,c){switch(a){case "value":this.b1(b);break;case "disabled":this.YH(b,!0)}this._super(a,b,c)},Wl:function(b,c){if("string"===typeof b)try{b=new a.o(b)}catch(f){a.C("ojColorSpectrum: invalid rawValue ("+
b+"), defaulting to black"),b=a.o.BLACK}var g={};g._context={originalEvent:c,zd:!0,kb:!0,readOnly:!0};this.xza(this.options.rawValue,b)||this.option("rawValue",b,g)},xza:function(a,b){return a.hD()===b.hD()&&a.$C()===b.$C()&&a.YC()===b.YC()&&a.XC()===b.XC()},sM:function(b,c){var f=c instanceof a.o;return b instanceof a.o&&f&&b.isEqual(c)},YH:function(a,b){var c=!b||b&&a!==this.jq;c&&(this.EBa(!a),a?(this.element.addClass("oj-disabled"),this.tha(!1)):(this.element.removeClass("oj-disabled"),this.tha(!0)),
this.jq=a);return c},b1:function(b){b instanceof a.o&&!this.sM(this.Af,b)&&(this.Nja(b),this.lka(this.xq,!0),this.lka(this.Ao,!1),this.f1(this.xq,this.lC,this.VB,this.Ao,!0))},Rha:function(b,e){var f,g,k,l,m;if(this.Jka&&("rawValue"==e.option||"value"==e.option)&&void 0!==e.value&&("value"==e.option&&(this.Kga=!!b.originalEvent),g=c(b.target),f=g.hasClass("oj-colorspectrum-hue"),g=g.hasClass("oj-colorspectrum-alpha"),f||g)){g=this.xq;k=this.lC;l=this.VB;m=this.Ao;f?(g=e.value,this.VP(g,k,l),this.f1(g,
k,l,m,!1)):(m=e.value,this.RH(g,k,l,m));f=new a.o({h:g,s:k,l:l,a:m});if(b.originalEvent||this.Kga)this.Kga=!1,"rawValue"===e.option?this.Wl(f,b):"value"===e.option&&this.dc(f,b);this.Nja(f)}},lka:function(a,b){(b?this.Ol:this.Nl).ojSlider("option","value",a)},f1:function(a,b,c,g,k){this.Qm.css("background-color","hsl("+a+", 100%, 50%)");k&&(k=this.aEa(b,c),this.oC(k.x,k.y));this.RH(a,b,c,g)},hNa:function(){var b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)";
switch(a.Qa.vm().browser){case a.Qa.Di.gK:b="moz";break;default:b="webkit";break;case a.Qa.Di.sE:b="ms"}b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)".replace(/___/g,b);this.Qm.css("backgroundImage",b)},oC:function(a,b){isNaN(a)||(this.zv=a);isNaN(b)||(this.Av=b);this.Fha(0,0)},aEa:function(a,b){var c=Math.min(a/100*this.Ss,this.Ss),g=this.ap-Math.min(b/
100*this.ap,this.ap);return{x:Math.round(c),y:Math.round(g)}},Fha:function(a,b){var c,g;c=this.zv+a;g=this.Av+b;0>c&&(c=0);0>g&&(g=0);c>=this.Ss&&(c=this.Ss-1);g>=this.ap&&(g=this.ap-1);this.zv=c;this.Av=g;c=c-this.Uk+"px";g=g-this.Uk+"px";this.ef[0].style.left=c;this.ef[0].style.top=g},GNa:function(b){if(!this.jq){var c=this.Qm.offset(),f=b.pageX-c.left,c=b.pageY-c.top,g,k,l,f=Math.round(f),c=Math.round(c);g=this.TY(f,c);k=g.vS;l=g.s4;g=this.xq;this.VP(g,k,l);var m=new a.o({h:g,s:k,l:l,a:this.Ao});
this.Wl(m,b);this.dc(m,b);this.RH(g,k,l,this.Ao);this.Af=m;this.kka(k,l);this.oC(f,c);this.ef.focus()}},vIa:function(a){var b,c,g,k=1;this.eha=(new Date).getTime();0>this.$u&&(this.$u=this.eha,this.dha=0);b=this.eha-this.$u;this.dha++;if(1400<b||25<this.dha)k=3;c=g=0;b=a.keyCode;if(40==b)g=k;else if(38==b)g=-k;else if(39==b)c=k;else if(37==b)c=-k;else if(36==b)this.oC(0,0),this.$u=-1;else if(35==b)this.oC(this.Ss-1,this.ap-1),this.$u=-1;else if(33==b)this.oC(NaN,0),this.$u=-1;else if(34==b)this.oC(NaN,
this.ap-1),this.$u=-1;else return;this.Fha(c,g);this.zfa(a,this.zv,this.Av);a.preventDefault();return!1},xIa:function(a){this.$u=-1;var b=this.TY(this.zv,this.Av);this.RH(this.xq,b.vS,b.s4,this.Ao);this.dc(this.options.rawValue,a)},rHa:function(){this.Qm[0].getBoundingClientRect();this.G1||(this.G1=this.YNa.bind(this));this.ef.draggable({drag:this.G1,stop:this.G1})},tha:function(a){this.ef.draggable(a?"enable":"disable")},YNa:function(a,b){var c,g,k,l;b.position.left<-this.Uk?(b.position.left=-this.Uk,
c=0):b.position.left+this.Uk>=this.Ss&&(b.position.left=this.Ss-1-this.Uk,g=this.Ss-1);b.position.top<-this.Uk?(b.position.top=-this.Uk,g=0):b.position.top+this.Uk>=this.ap&&(b.position.top=this.ap-1-this.Uk,g=this.ap-1);k=this.ef.offset();l=this.Qm.offset();0!=c&&(c=k.left+this.Uk-l.left);0!=g&&(g=k.top+this.Uk-l.top);if(this.zv!==c||this.Av!==g)"drag"===a.type?(this.zv=c,this.Av=g):(c=this.zv,g=this.Av),this.zfa(a,c,g)},zfa:function(b,c,f){var g,k,l=!1;g=this.xq;f=this.TY(c,f);c=f.vS;f=f.s4;this.VP(g,
c,f);k=new a.o({h:g,s:c,l:f,a:this.Ao});this.Wl(k,b);"dragstop"===b.type&&(this.dc(k,b.originalEvent),l=!0);this.Af=k;this.kka(c,f);l&&this.RH(g,c,f,this.Ao)},TY:function(a,b){return{vS:a/(this.Ss-1)*100,s4:100-b/(this.ap-1)*100}},VP:function(a,b,c){var g="hsla("+a+","+b+"%,"+c+"%, 0)";b="hsla("+a+","+b+"%,"+c+"%, 1.0)";this.QB&&(a=b,b=g,g=a);this.pX=a="linear-gradient(90deg, "+g+", "+b+"),"+this.NV;this.LK.css("background",a)},XDa:function(a,b,c,g){var k="number"===typeof g&&1>g;a=Math.round(a);
b=Math.round(100*b)/100;c=Math.round(100*c)/100;return a="hsl"+(k?"a(":"(")+(a+", "+b+"%, "+c+"%"+(k?","+g:"")+")")},kka:function(a,b){this.lC=a;this.VB=b},Nja:function(a){a&&(this.Af=a,a=b(a),this.xq=a[0],this.lC=a[1],this.VB=a[2],this.Ao=a[3])},RH:function(a,b,c,g){this.ef.attr("aria-valuetext",this.XDa(a,b,c,g))},iHa:function(){this.JG();this.hb()},hb:function(){this.Sg.append(this.bH);this.Sg.addClass("oj-colorspectrum");c(".oj-colorspectrum-hue").uniqueId();c(".oj-colorspectrum-alpha").uniqueId();
this.Sg.find(".oj-colorspectrum-container");this.Ol=this.Sg.find(".oj-colorspectrum-hue");this.Nl=this.Sg.find(".oj-colorspectrum-alpha");this.Qm=this.Sg.find(".oj-colorspectrum-spectrum");this.ef=this.Sg.find(".oj-colorspectrum-thumb");this.Uk=this.ef[0].offsetWidth/2;0>=this.Uk&&(this.Uk=this.ef.width()/2);this.ky=a.Q.Re();this.Ss=this.Qm.width();this.ap=this.Qm.height();this.ef.attr("aria-describedby",this.Sg.find(".oj-colorspectrum-thumb-description").uniqueId().attr("id"));this.NV="url('"+a.oa.vb("common/images/spectrum-opacity-slider-bg.png")+
"')";this.NV=this.NV.replace("js","css");var d=this.jq?!0:!1,e=b(this.Af);this.xq=e[0];this.lC=e[1];this.VB=e[2];this.Ao=e[3];this.Jka=!1;this.Ol.ojSlider({max:360,min:0,step:1,value:this.xq,orientation:"vertical",optionChange:this.Rha.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal","");this.Nl.ojSlider({max:1,min:0,step:.01,value:this.Ao,orientation:"horizontal",optionChange:this.Rha.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal",
"");this.pHa();this.hNa();this.f1(this.xq,this.lC,this.VB,this.Ao,!0);this.Qm.click(this.GNa.bind(this));this.rHa();this.YH(d);this.ef.keydown(this.vIa.bind(this));this.ef.keyup(this.xIa.bind(this));this.Qm.focus(this.xJa.bind(this));this._focusable({element:this.ef,nXa:!0});a.Q.Re()&&this.m1(this.ef)},xJa:function(){this.ef.focus();return!1},pHa:function(){var a={subId:"oj-slider-bar"};this.MK=c(this.Ol.ojSlider("getNodeBySubId",a));this.LK=c(this.Nl.ojSlider("getNodeBySubId",a));a.ZXa="oj-slider-bar-value";
c(this.Ol.ojSlider("getNodeBySubId",a));c(this.Nl.ojSlider("getNodeBySubId",a));this.MK.css("background","linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)");this.qX="linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)";this.VP(this.xq,this.lC,this.VB);this.Jka=!0},JG:function(){this.TV();this.Av=this.zv=0;var a=this.bg(this.R("labelHue")),b=this.bg(this.R("labelOpacity"));this.bH=
["\x3cdiv class\x3d'oj-colorspectrum-container'\x3e\x3cdiv class\x3d'oj-colorspectrum-spectrum' tabindex\x3d'-1' style\x3d'position:relative'\x3e\x3cdiv class\x3d'oj-colorspectrum-thumb' role\x3d'slider' aria-describedby\x3d'' style\x3d'position:absolute;top:-9999px;left:-9999px;' tabIndex\x3d'0'\x3e\x3c/div\x3e\x3c/div\x3e","\x3cdiv class\x3d'oj-colorspectrum-thumb-description oj-helper-hidden-accessible'\x3e"+this.bg(this.R("labelThumbDesc"))+"\x3c/div\x3e","\x3cinput class\x3d'oj-colorspectrum-hue' aria-label\x3d'"+
a+"'\x3e\x3c/input\x3e","\x3cinput class\x3d'oj-colorspectrum-alpha' aria-label\x3d'"+b+"'\x3e\x3c/input\x3e","\x3c/div\x3e"].join("");this.$u=-1;this.QB="rtl"===this.sd()},TV:function(){var b=this.options,e;this.Sg=c(this.element);this.jq=!1;e=b.value;e instanceof a.o||(e=null);this.Af=e?e:a.o.BLACK;b.rawValue=this.Af;e=b.disabled;this.jq="boolean"===typeof e?e:!1},EBa:function(a){var b=!a;a?(this.Ol.ojSlider("option","disabled",b),this.Nl.ojSlider("option","disabled",b),b={subId:"oj-slider-bar"},
this.Ol=this.Sg.find(".oj-colorspectrum-hue"),this.Nl=this.Sg.find(".oj-colorspectrum-alpha"),this.MK=c(this.Ol.ojSlider("getNodeBySubId",b)),this.LK=c(this.Nl.ojSlider("getNodeBySubId",b)),this.pX&&this.LK.css("background",this.pX),this.qX&&this.MK.css("background",this.qX)):((a=this.MK.css("background"))&&0<a.length&&(this.qX=a),(a=this.LK.css("background"))&&0<a.length&&(this.pX=a),this.Ol.ojSlider("option","disabled",b),this.Nl.ojSlider("option","disabled",b))},QAa:function(){this.Ol.ojSlider("destroy");
this.Nl.ojSlider("destroy")},kLa:function(){this.Sg.empty()},aza:function(){this.Qm.off("click");this.ef.off("mousedown");this.ef.off("keydown");this.ef.off("keyup");this.oI&&this.D1(this.ef)},Ax:function(){this.bH=this.Sg=this.Ol=this.Nl=this.Qm=this.ef=null},m1:function(b){this.oI=a.yg.E2(b)},D1:function(b){a.yg.k5(b)},_GetMessagingLauncherElement:function(){return this.element},cg:function(){return this.ef},fu:function(){return this.Af},Jj:function(b){this.Af="string"===typeof b?new a.o(b):b},
ji:function(){return this.Af.toString()},_GetDefaultStyleClass:function(){return"oj-colorspectrum"},bg:function(a){return c("\x3cspan\x3e"+a+"\x3c/span\x3e").text()}})})()});