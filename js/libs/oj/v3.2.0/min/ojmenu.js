/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","hammerjs","ojs/ojjquery-hammer","promise","ojs/ojcomponentcore","ojs/ojpopupcore"],function(a,g,c){(function(){a.ab("oj.ojMenu",g.oj.baseComponent,{defaultElement:"\x3cul\x3e",delay:300,role:"menu",widgetEventPrefix:"oj",options:{menuSelector:"ul",openOptions:{display:"auto",initialFocus:"menu",launcher:null,position:{my:"start top",at:"start bottom",collision:"flipfit"}},submenuOpenOptions:{position:{my:"start top",at:"end top",collision:"flipfit"}},beforeOpen:null,
close:null,open:null,select:null},_ComponentCreate:function(){this._super();var a=this;this._focusForTesting=this.Ri;this._nextForTesting=this.Iha;this._selectForTesting=this.Yo;this.Zy=this.element;this.V4=!1;if(h&&"ul"!==this.element[0].tagName.toLowerCase())throw Error("Cancel item supported for \x3cul\x3e menus only.");this.tNa();this.element.uniqueId().addClass("oj-menu oj-component").hide().attr({role:this.role,tabIndex:"0"});this._on(!0,{"mousedown .oj-menu-item":function(a){this.options.disabled&&
a.preventDefault()},click:function(a){this.options.disabled&&a.preventDefault()},keydown:function(a){!this.options.disabled||a.keyCode!==g.ui.keyCode.ESCAPE&&a.keyCode!==g.ui.keyCode.TAB||(a.keyCode===g.ui.keyCode.TAB&&a.preventDefault(),this.Ke&&this.cG(a))}});this.options.disabled&&this.element.addClass("oj-disabled").attr("aria-disabled","true");var b=function(a){if(!this.r3){this.r3=!0;var b=g(a.currentTarget);try{this.Uca=!0,this.Ri(a,b)}finally{this.Uca=!1}}}.bind(this),c=function(a){a&&a.target&&
!g(a.target).is(":visible")||this.bm(a,"eventSubtree")}.bind(this);this._on({"mousedown .oj-menu-item \x3e a":function(a){a.preventDefault()},"click .oj-disabled \x3e a":function(a){a.preventDefault()},click:function(){this.V4=!1},touchstart:function(){this.r3=!1},mouseover:function(){this.r3=!1},"click .oj-menu-item:has(a)":function(a){var b=g(a.target).closest(".oj-menu-item");!this.V4&&b.not(".oj-disabled").length&&(this.V4=!0,a.preventDefault(),this.pb&&this.pb.closest(b).length&&this.pb.get(0)!=
b.get(0)||(b.has(".oj-menu").length?this.uf(a):(this.Yo(a),this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.pb&&1===this.pb.parents(".oj-menu").length&&this.gf&&this.gf()))))},"mouseenter .oj-menu-item":b,"touchstart .oj-menu-item":b,mouseleave:c,"mouseleave .oj-menu":c,focus:function(a,b){if(!b){var c=this.pb||this.element.children(".oj-menu-item").eq(0);this.Ri(a,c)}},keydown:this.av,keyup:function(a){if(a.keyCode==g.ui.keyCode.ENTER||a.keyCode==g.ui.keyCode.SPACE)this.TL=!1}});
this._focusable({applyHighlight:!e,recentPointer:function(){return a.Uca},setupHandlers:function(b,c){a.sB=b;a.Lx=c}});this.Jla=g.proxy(this.tI,this);this.hb()},RA:function(a){if(arguments.length)d=a;else return d},IW:function(a){if(("focus"===a.type||"mousedown"===a.type||"touchstart"===a.type||93==a.which||121==a.which&&a.shiftKey||93==a.keyCode)&&("mousedown"!==a.type||!d)){var c=b.slice(0,b.length);g.each(c,function(b,c){!g(a.target).closest(c.element).length&&("keydown"===a.type||"mousedown"===
a.type&&3===a.which||!g(a.target).closest(c.Ke).length||c.CIa&&("mousedown"===a.type&&3!==a.which||"touchstart"===a.type))&&(c.bm(a,"eventSubtree"),c.Ke&&c.tx(a))})}},_setOption:function(a,b){this._superApply(arguments);switch(a){case "translations.labelCancel":case "translations":this.waa&&this.waa.text(this.options.translations.labelCancel)}},_destroy:function(){this.element.is(":visible")&&this.tx();this.gf&&this.gf();delete this.gf;this.element.removeAttr("aria-activedescendant").removeClass("oj-component").find(".oj-menu").addBack().removeClass("oj-menu oj-menu-submenu oj-menu-icons oj-menu-text-only").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();
this.element.find(".oj-menu-item").removeClass("oj-menu-item").removeAttr("role").children("a").removeAttr("aria-disabled").removeUniqueId().removeClass("oj-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var a=g(this);a.data("oj-ojMenu-submenu-icon")&&a.remove()});this.element.find("a").removeAttr("aria-expanded");this.element.find(".oj-menu-divider").removeClass("oj-menu-divider").removeAttr("role");0<=b.indexOf(this)&&b.splice(b.indexOf(this),
1);delete this.Wo;delete this.Jla;var a=this.Iaa;delete this.Iaa;a&&a();this.mM&&this.mM.remove();this.element.Ng("destroy");this._super()},av:function(a){function b(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")}var c,d,e,f,h=!0;switch(a.keyCode){case g.ui.keyCode.HOME:this.LO("first","first",a);break;case g.ui.keyCode.END:this.LO("last","last",a);break;case g.ui.keyCode.UP:this.fKa(a);break;case g.ui.keyCode.DOWN:this.Iha(a);break;case g.ui.keyCode.LEFT:case g.ui.keyCode.RIGHT:a.keyCode===
g.ui.keyCode.RIGHT^this.zm?this.pb&&!this.pb.is(".oj-disabled")&&this.uf(a):this.bm(a,"active");break;case g.ui.keyCode.ENTER:case g.ui.keyCode.SPACE:this.bFa(a);this.TL=!0;var k=this;setTimeout(function(){k.TL=!1},100);break;case g.ui.keyCode.TAB:a.preventDefault();this.Ke&&this.cG(a);break;case g.ui.keyCode.ESCAPE:this.Ke?(d=this.element.attr("aria-activedescendant"),e="#"+this.element.attr("id")+"\x3e*\x3ea",d&&!g("#"+d).is(e)?this.bm(a,"active"):this.cG(a)):this.bm(a,"active");break;default:h=
!1,c=this.lS||"",d=String.fromCharCode(a.keyCode),e=!1,clearTimeout(this.JQa),d===c?e=!0:d=c+d,f=new RegExp("^"+b(d),"i"),c=this.Zy.children(".oj-menu-item").filter(function(){return f.test(g(this).children("a").text())}),c=e&&-1!==c.index(this.pb.next())?this.pb.nextAll(".oj-menu-item"):c,c.length||(d=String.fromCharCode(a.keyCode),f=new RegExp("^"+b(d),"i"),c=this.Zy.children(".oj-menu-item").filter(function(){return f.test(g(this).children("a").text())})),c.length?(this.Ri(a,c),1<c.length?(this.lS=
d,this.JQa=setTimeout(function(){delete this.lS}.bind(this),1E3)):delete this.lS):delete this.lS}h&&a.preventDefault()},bFa:function(a){this.pb&&!this.pb.is(".oj-disabled")&&(this.pb.children("a[aria-haspopup\x3d'true']").length?this.uf(a):this.Yo(a))},refresh:function(){this._super();this.hb();var a=this.element;if(a.is(":visible")){var b=a.data("oj-menu-position");b&&(b.of instanceof g.Event||b.of instanceof Window||g(b.of).is(":visible"))&&(a.position(b),a.find(".oj-menu").each(function(){var a=
g(this);a.is(":visible")&&(b=a.data("oj-menu-position"))&&a.position(b)}))}},hb:function(){this.zm="rtl"===this.sd();var a=this,b=this.element.find(this.options.menuSelector),c=b.add(this.element),d=c.children();this.NGa=!!b.length;d.filter(".oj-menu-divider").has("a").removeClass("oj-menu-divider oj-menu-item").removeAttr("role");var e=d.filter(":not(.oj-menu-item):has(a)"),f=e.children("a");this.ega(e);this.Ufa(f);e=d.filter(function(a,b){var c=g(b);return c.is(":not(.oj-menu-item)")&&!/[^\-\u2014\u2013\s]/.test(c.text())});
this.aga(e);this.fHa(d,e);d.filter(".oj-disabled").children("a").attr("aria-disabled","true");d.filter(":not(.oj-disabled)").children("a").removeAttr("aria-disabled");b.filter(":not(.oj-menu)").addClass("oj-menu oj-menu-submenu oj-menu-dropdown").hide().attr({role:this.role,"aria-hidden":"true"}).each(function(){var b=g(this),c=a.ZY(b),d=g("\x3cspan\x3e");d.addClass("oj-menu-submenu-icon oj-component-icon").data("oj-ojMenu-submenu-icon",!0);c.attr("aria-haspopup","true").attr("aria-expanded","false").append(d);
c=c.attr("id");b.attr("aria-labelledby",c)});c.each(function(){var a=g(this),b=a.children().children().children(".oj-menu-item-icon:not(.oj-menu-cancel-icon)").length;a.toggleClass("oj-menu-icons",!!b).toggleClass("oj-menu-text-only",!b)});this.pb&&!g.contains(this.element[0],this.pb[0])&&this.bW()},ega:function(a){a.addClass("oj-menu-item").attr("role","presentation")},Ufa:function(a){a.uniqueId().attr({tabIndex:"-1",role:"menuitem"})},aga:function(a){a.addClass("oj-menu-divider").attr("role","separator")},
fHa:function(a,b){a.removeClass("oj-menu-item-before-divider oj-menu-item-after-divider");b.prev().addClass("oj-menu-item-before-divider");b.next().addClass("oj-menu-item-after-divider")},ZY:function(a){return a.prev("a")},XWa:function(){return"menuitem"},eN:function(a,b){var c=a.prev(".oj-menu-divider").add(a.next(".oj-menu-divider"));b&&(c=c.add(a));return c},Ri:function(a,b){a&&"focus"===a.type||this.gf&&this.gf();b=b.first();this.qha(b,a);var c=b.parent(),d=c.closest(".oj-menu-item");c.find(".oj-focus-ancestor").removeClass("oj-focus-ancestor");
this.eN(d,!0).addClass("oj-focus-ancestor");a&&"keydown"===a.type?this.ks():this.gf=this.ZH(function(){delete this.gf;this.ks()},this.ON("closing"),this.delay);c=b.children(".oj-menu");c.length&&a&&/^mouse/.test(a.type)&&!this.pb.hasClass("oj-disabled")&&this.HNa(c);this.Zy=b.parent()},qha:function(a,b){if(!a.is(this.pb)){var c=this.pb?this.pb:g(),d=a.children("a");this.pb=a;this.element.attr("aria-activedescendant",d.attr("id"));this.Lx(c);this.sB(a);this.eN(c).removeClass("oj-focus");this.eN(a).addClass("oj-focus");
this._trigger("_activeItem",b,{previousItem:c,item:a,privateNotice:"The _activeItem event is private.  Do not use."})}},UKa:function(a){if(this.pb){var b=this.pb;this.pb=null;this.element.removeAttr("aria-activedescendant");this.Lx(b);this.eN(b).removeClass("oj-focus");this._trigger("_activeItem",a,{previousItem:b,item:g(),privateNotice:"The _activeItem event is private.  Do not use."})}},bW:function(a){this.gf&&this.gf();this.UKa(a)},cG:function(a,b){this.Ke.focus();this.tx(a,b)},tx:function(b,c){if(!this.Zu("close",
"__dismiss",[b,c])){var d=this.element.is(":visible");this.Iq("close");var e={};e[a.$.La.De]=this.element;e[a.$.La.Xz]={event:b,selectUi:c,isOpen:d};a.$.lc().close(e)}},tF:function(b){var c=b[a.$.La.De];if((b=(a.wc.Kd("oj-menu-option-defaults")||{}).animation)&&b.close)return a.ha.Yn(c,"close",b.close).then(function(){c.hide()});c.hide()},ds:function(c){var d=c[a.$.La.Xz];c=d.event;var e=d.selectUi,d=d.isOpen;this.element.removeData("oj-menu-position");this.Ke=void 0;this.uka=!1;e&&(c=this.Y1("select",
c,e).event);d&&this._trigger("close",c,{});this.Bu=null;0<=b.indexOf(this)&&b.splice(b.indexOf(this),1)},getCurrentOpenOptions:function(){return g.extend(!0,{},this.Bu||this.options.openOptions)},open:function(c,d,e){if(!this.Zu("open","open",[c,d,e])){d=g.extend({},this.options.openOptions,d);d.position=g.extend({},d.position);e=g.extend({},this.options.submenuOpenOptions,e);var f=this.Bu;this.Bu=d;a.Ra.yJa(c);this.CIa=this.SL;var h=this.Y1("beforeOpen",c,{openOptions:d});if(h.proceed)if(this.element.is(":visible")&&
(this.Bu=f,this.tx(h.event),this.Bu=d),f=d.launcher,(f="string"===g.type(f)?g(f):f)&&f.length){h=this.RHa(d.display);this.fOa(h);var k,n;if(h){if(this.element.addClass("oj-menu-dropdown").removeClass("oj-menu-sheet"),n=l,k=a.Ra.xp(d.position,this.zm),k.of=a.Ra.ETa(k.of,f,c),null==k.of){a.C.warn("position.of passed to Menu.open() is 'event', but the event is null.  Ignoring the call.");this.Bu=null;return}}else this.element.addClass("oj-menu-sheet").removeClass("oj-menu-dropdown"),n=m,k={my:"bottom",
at:p,of:window,collision:"flipfit"};var s=this.element[0],t=b.slice(0,b.length);g.each(t,function(a,b){b.element[0]!==s&&(b.bm(c,"eventSubtree"),b.Ke&&b.tx(c))});this.MNa=a.Ra.xp(e.position,this.zm);e=this.Jla;g.isFunction(k.using)&&k.using!==e&&(k.origUsing=k.using);k.using=e;this.element.data("oj-menu-position",k);this.Iq("open");e={};e[a.$.La.De]=this.element;e[a.$.La.gA]=f;e[a.$.La.Lr]=k;e[a.$.La.Gr]=this.BB();e[a.$.La.Xt]="oj-menu-layer";e[a.$.La.Fl]=n;e[a.$.La.Xz]={event:c,initialFocus:d.initialFocus,
launcher:f,isDropDown:h};a.$.lc().open(e)}else a.C.warn("When calling Menu.open(), must specify openOptions.launcher via the component option, method param, or beforeOpen listener.  Ignoring the call."),this.Bu=null;else this.Bu=f}},uF:function(b){var c=b[a.$.La.De];b=b[a.$.La.Lr];c.show();c.position(b);if((b=(a.wc.Kd("oj-menu-option-defaults")||{}).animation)&&b.open)return a.ha.Yn(c,"open",b.open)},kF:function(c){var d=c[a.$.La.Xz];c=d.event;var e=d.initialFocus,f=d.launcher,d=d.isDropDown,g="firstItem"===
e;(g||"menu"===e)&&this.element.focus();g?this.Ri(c,this.element.children().first()):this.bW(c);this.Ke=f;this.uka=!d;b.push(this);this._trigger("open",c,{})},HNa:function(a){this.gf&&this.gf();"true"===a.attr("aria-hidden")&&(this.gf=this.ZH(function(){delete this.gf;this.ks();this.Tha(a)},this.ON("closing and opening"),this.delay))},Tha:function(a){var c=g.extend({of:this.pb},this.MNa);this.gf&&this.gf();this.element.find(".oj-menu").not(a.parents(".oj-menu")).hide().attr("aria-hidden","true").removeData("oj-menu-position");
a.show().removeAttr("aria-hidden").position(c).data("oj-menu-position",c);this.ZY(a).attr("aria-expanded","true");!this.Ke&&0>b.indexOf(this)&&b.push(this)},RL:function(a,b,c){function d(){delete e.gf;var c=b?e.element:g(a&&a.target).closest(e.element.find(".oj-menu"));c.length||(c=e.element);e.ks(c);e.bW(a);e.Zy=c}this.gf&&this.gf();var e=this;c?this.gf=this.ZH(d,this.ON("closing"),c):d()},ks:function(a){a||(a=this.pb?this.pb.parent():this.element);var c=a.find(".oj-menu");c.hide().attr("aria-hidden",
"true").removeData("oj-menu-position");this.ZY(c).attr("aria-expanded","false");a.find(".oj-focus-ancestor").removeClass("oj-focus-ancestor");this.Ke||0<=b.indexOf(this)&&a===this.element&&b.splice(b.indexOf(this),1)},bm:function(b,c){if(null==c||"active"===c){var d=this.Zy&&this.Zy.closest(".oj-menu-item",this.element);d&&d.length&&(this.ks(),this.Ri(b,d))}else"all"===c||"eventSubtree"===c?this.RL(b,"all"===c,this.delay):a.C.warn("Invalid param "+c+" passed to Menu._collapse().  Ignoring the call.")},
uf:function(a){var b=this.pb&&this.pb.children(".oj-menu ").children(".oj-menu-item").first();b&&b.length&&(this.Tha(b.parent()),this.gf&&this.gf(),this.gf=this.ZH(function(){delete this.gf;this.Ri(a,b)},this.gN("focusing an item")))},Iha:function(a){this.LO("next","first",a)},fKa:function(a){this.LO("prev","last",a)},TWa:function(){return this.pb&&!this.pb.prevAll(".oj-menu-item").length},UWa:function(){return this.pb&&!this.pb.nextAll(".oj-menu-item").length},LO:function(a,b,c){var d;this.pb&&(d=
"first"===a||"last"===a?this.pb["first"===a?"prevAll":"nextAll"](".oj-menu-item").eq(-1):this.pb[a+"All"](".oj-menu-item").eq(0));d&&d.length&&this.pb||(d=this.Zy.children(".oj-menu-item")[b]());this.Ri(c,d)},Yo:function(b){if(!this.pb&&b&&b.target){var c=g(b.target).closest(".oj-menu-item");c.closest(this.element).length&&this.qha(c,b)}this.pb?this.pb.has(".oj-menu").length||this.pb.is(".oj-disabled")?a.C.warn("Selecting a disabled menu item or parent menu item is not allowed."):(c=this.pb.is(this.nM)?
void 0:{item:this.pb},this.RL(b,!0),this.Ke&&this.cG(b,c)):a.C.warn("Menu._select() called when no menu item is focused and no menu item can be inferred from event param.")},Ry:function(){this.element.remove()},BB:function(){if(!this.Wo){var b=this.Wo={};b[a.$.ic.iA]=this.Qaa.bind(this);b[a.$.ic.jA]=this.Ry.bind(this);b[a.$.ic.Kr]=this.refresh.bind(this);b[a.$.ic.hA]=this.IW.bind(this);b[a.$.ic.BK]=this.uF.bind(this);b[a.$.ic.zK]=this.kF.bind(this);b[a.$.ic.AK]=this.tF.bind(this);b[a.$.ic.yK]=this.ds.bind(this)}return this.Wo},
Qaa:function(){this.ks(this.element);this.tx(null)},tI:function(b,c){var d=c.element.element;d.css(b);(d=d.data("oj-menu-position"))&&(d=d.origUsing)&&d(b,c);a.Ra.h4(c)&&(this.Iaa=this.ZH(this.Qaa,this.ON("closing"),1))},getNodeBySubId:function(a){switch(a&&a.subId){case n:return this.uW?this.nM[0]:null;default:return this._super(a)}},getSubIdByNode:function(a){return this.nM&&this.nM.is(a)?n:this._super(a)},RHa:function(a){if(this.NGa)return!0;switch(a){case "dropDown":return!0;case "sheet":return!1;
case "auto":return s.matches;default:throw Error("Invalid value for Menu openOptions.display: "+a);}},fOa:function(a){h&&(a?this.uW&&(this.dda().detach().eq(0).prev().removeClass("oj-menu-item-before-divider"),this.uW=!1):(this.dda().appendTo(this.element).eq(0).prev().addClass("oj-menu-item-before-divider"),this.uW=!0))},dda:function(){if(!this.mM){var a=g("\x3cli\x3e\x3c/li\x3e",this.document[0]),b=g("\x3ca href\x3d'#'\x3e\x3c/a\x3e",this.document[0]).text(this.options.translations.labelCancel);
g("\x3cspan class\x3d'oj-menu-item-icon oj-component-icon oj-menu-cancel-icon'\x3e\x3c/span\x3e",this.document[0]).prependTo(b);var c=g("\x3cli\x3e\x3c/li\x3e",this.document[0]).addClass("oj-menu-item-cancel oj-menu-item-after-divider").append(b);this.aga(a);this.Ufa(b);this.ega(c);this.waa=b;this.nM=c;this.mM=g([a[0],c[0]])}return this.mM},tNa:function(){k&&(this.element.Ng(t),this._on({swipedown:function(a){this.uka&&"touch"===a.gesture.pointerType&&(this.RL(a,!0),this.cG(a))}}))},Iq:function(b){var c=
this.dp;c&&(c.destroy(),delete this.dp);0>["open","close"].indexOf(b)||(this.dp=new a.Il(this.element,b,"ojMenu",this.ki()))},Zu:function(a,b,c){var d=this.dp;return d?d.n4(this,a,b,c):!1},ZH:function(b,c,d){var e=a.Context.getContext(this.element[0]).ye().Ed({description:c}),f=this,g=setTimeout(function(){b.bind(f)();e&&(e(),e=null)},d||0);return function(){clearTimeout(g);e&&(e(),e=null)}},gN:function(a){return"Menu with id '"+this.element.attr("id")+"' is busy "+a+"."},ON:function(a){return this.gN(a+
" a submenu")}});var b=[],d=!1,e=-1<navigator.userAgent.indexOf("Macintosh")&&-1<navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome"),f=a.wc.Kd("oj-menu-config")||{},h="menuItem"===f.sheetCancelAffordance,k="dismiss"===f.sheetSwipeDownBehavior,l=f.dropDownModality||"modeless",m=f.sheetModality||"modal",p="bottom-"+(f.sheetMarginBottom||0),t=k&&{recognizers:[[c.Swipe,{direction:c.DIRECTION_DOWN}]]},s=function(){var a=f.dropDownThresholdWidth;null==a&&(a="768px");return window.matchMedia("(min-width: "+
a+")")}(),n="oj-menu-cancel-command"})();a.U.qb("oj-menu","baseComponent",{properties:{disabled:{type:"boolean"},menuSelector:{type:"string"},openOptions:{type:"Object"},submenuOpenOptions:{type:"Object"}},methods:{destroy:{},getCurrentOpenOptions:{},getSubIdByNode:{},open:{},refresh:{},widget:{}},extension:{Ug:"ul",nb:"ojMenu"}});a.U.register("oj-menu",{metadata:a.U.getMetadata("oj-menu")})});