/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","jquery","ojs/ojcomponentcore","ojs/ojarraytabledatasource","ojs/ojcolor","ojs/ojlistview","ojs/ojeditablevalue"],function(a,g,c){(function(){a.ab("oj.ojColorPalette",c.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{palette:null,swatchSize:"lg",labelDisplay:null,layout:"grid",value:null,disabled:!1},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var c=a.index,e=null;switch(a.subId){case "oj-palette-entry":a=
this.pe.find(".oj-listview-item"),a.length&&c<a.length&&(e=a[c])}return e},getSubIdByNode:function(a){var d=c(a);a=null;var e=-1,f=null,g;d.is("li")&&d.hasClass("oj-listview-item-element")&&(a="oj-palette-entry",g=d.attr("id"),d=this.pe.find(".oj-listview-item"),c.each(d,function(a,b){if(c(b).attr("id")===g)return e=a,!1}));a&&(f={subId:a},0<=e&&(f.index=e));return f},add:function(b){var c=null,e;b instanceof a.o?c={color:b}:"object"===typeof b&&(e=b.color,e instanceof a.o&&(c=b));c&&(this.DP("The swatch add is being animated in the palette (id\x3d"+
this.element.attr("id")+")."),c.id=this.dea(),this.km||(this.km=[]),this.km.push({Uf:"a",gS:c}),this.cC.add(c),this.w2())},remove:function(b){var c=null,e;e=typeof b;"number"===e?0<=b&&b<this.nn.length?c=this.nn[b].id:a.C.error("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Invalid index for remove ("+b+")"):"object"===e&&(b=b instanceof a.o?b:b.color,c=this.cCa(b));c&&(b={id:c},this.DP("The removed swatch is being animated in the palette (id\x3d"+this.element.attr("id")+")."),this.km||
(this.km=[]),this.km.push({Uf:"r",gS:b}),this.cC.remove(b),this.w2())},whenReady:function(){var a=this;return new Promise(function(c){a.pe.ojListView("whenReady").then(function(){c(!0)})})},_destroy:function(){this.I0();this.pe&&(this.km=[],this.pe.ojListView("destroy"));this.cC=null;this.B7.remove();this.Sg.removeClass("oj-colorpalette");this.Ax();this._super()},_ComponentCreate:function(){this._super();this.oHa()},Tg:function(){this._super();var b=this.cL();b?(b=b.attr("id"))?this.pe.attr("aria-labelledby",
b):a.C.warn("JET Color Palette: The label for this component needs an id in order to be accessible"):(b=this.element.attr("aria-label"))&&this.pe.attr("aria-label",b)},_setOption:function(a,c,e){switch(a){case "value":this.b1(c);break;case "palette":this.XMa(c);break;case "swatchSize":this.YMa(c);break;case "layout":this.WMa(c);break;case "labelDisplay":this.VMa(c);break;case "disabled":this.YH(c,!0)}this._super(a,c,e)},DJa:function(a,c){"selection"===c.option&&this.jMa(a,c)},w2:function(){if(!this.EU){var b=
this;this.EU=a.Context.getContext(this.pe[0]).ye();this.EU.whenReady().then(function(){b.EU=null;var a,c,f,g,k;b.I0();if(b.km){f=!1;for(k=0;k<b.km.length;k++)if(a=b.km[k],c=a.gS,"a"===a.Uf||"r"===a.Uf)f=!0,g||(g=b.nn.slice(0)),"a"===a.Uf?g.push(c):"r"===a.Uf&&(c=b.bCa(g,c.id),g.splice(c,1),a.index=c);if(f)for(b.Kx("palette",g,null);b.km.length;)a=b.km.shift(),c=a.gS,"a"===a.Uf?b.nn.push(c):"r"===a.Uf&&b.nn.splice(a.index,1)}},function(){a.C.error("JET Color Palette (id\x3d'"+b.element.attr("id")+
"'): ListView timed out.");b.km=[]})}},sM:function(b,c){var e=c instanceof a.o,f=!1;b instanceof a.o&&e&&(f=b.isEqual(c));return f},Kx:function(a,c,e){"palette"===a&&this.option(a,c,{_context:{originalEvent:e,kb:!0},changed:!0})},LX:function(a){var c=-1,e=this.nn,f=e.length,g,k;for(g=0;g<f;g++)if(k=e[g],a.isEqual(k.color)){c=g;break}return c},cCa:function(a){var c=null,e=this.nn,f=e.length,g,k;for(g=0;g<f;g++)if(k=e[g],a.isEqual(k.color)){c=k.id;break}return c},bCa:function(a,c){var e=-1,f=a.length,
g,k;for(g=0;g<f;g++)if(k=a[g],k.id===c){e=g;break}return e},DP:function(b){this.qP||(this.qP=a.Context.getContext(this.element[0]).ye().Ed({description:b}))},I0:function(){this.qP&&(this.qP(),this.qP=null)},DLa:function(b){var c,e,f,g,k,l;c=b.data.color;c instanceof a.o||(c=a.o.BLACK,a.C.warn("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Substituting oj.Color.BLACK for an object that is not an instance of oj.Color"));e=f=b.data.label;g="auto"===this.FO&&"list"===this.Lf&&"sm"===this.wC||
"auto"===this.FO&&"grid"===this.Lf&&"lg"===this.wC;null!=c&&(l=e?e:this.QW.format(c),g?(e=l?l:this.QW.format(c),e=f?e:e.toUpperCase()):e=null,k=!!(this.oIa(c)||e&&"none"===e.toLowerCase()));f="";this.im===b.data.id&&(f="oj-selected",this.im=-1,this.S0=b.parentElement);b="list"===this.Lf?"oj-colorpalette-swatchsize-"+this.wC+(k?" oj-colorpalette-swatch-none":""):this.Uka+(k?" oj-colorpalette-swatch-none":"");return k?this.zLa(g,e,l,b,f):this.BLa(c,g,e,l,b,f)},BLa:function(a,d,e,f,g,k){a="\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+
g+(d?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+k+"' style\x3d'background-color:"+a.toString()+"'"+(e?"":" title\x3d'"+f+"'")+"\x3e\x3c/div\x3e\x3c/div\x3e";e&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+e+"\x3c/span\x3e");return c(a+"\x3c/div\x3e")[0]},zLa:function(a,d,e,f,g){a="\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+f+(a?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+
g+"'"+(d?"":" title\x3d'"+e+"'")+"\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-none-icon'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";d&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+d+"\x3c/span\x3e");return c(a+"\x3c/div\x3e")[0]},jMa:function(a,d){var e=null,f,e=c(d.items[0]).find(".oj-colorpalette-swatch");e.addClass("oj-selected");f=this.lMa;this.lMa=e;!f&&this.S0&&(f=c(this.S0).find(".oj-colorpalette-swatch"),this.S0=null);f&&f.removeClass("oj-selected");1===d.value.length&&(e=this.nn[d.value].color,
this.dc(e,a),this.Af=e)},YH:function(a,d){var e,f;if(!d||d&&a!==this.jq)this.pe&&this.pe.ojListView("option","disabled",a),e=c(".oj-colorpalette-container .oj-colorpalette-swatch"),f=this,a?(this.TF=[],c.each(e,function(a,b){f.TF.push(b.style.backgroundColor);b.style.backgroundColor="#eee"})):(this.TF&&this.TF.length&&c.each(e,function(a,b){b.style.backgroundColor=f.TF[a]}),this.TF=null),this.jq=a},b1:function(b){var c=-1,e=[];0<this.nn.length&&b instanceof a.o&&!this.sM(this.Af,b)&&(c=this.LX(b),
0<=c&&e.push(c),this.pe.ojListView("option","selection",e),this.Af=b);return 0<=c},XMa:function(a){c.isArray(a)&&!this.iIa(a,this.nn)&&(this.DP("The palette (id\x3d"+this.element.attr("id")+") option change in progress."),this.km=[],this.nn=a.slice(0),this.im=this.LX(this.Af),this.Pja(a,this.im,!0),this.w2())},YMa:function(a){"string"===typeof a&&a!==this.wC&&(this.wC=a,this.Uka="oj-colorpalette-swatchsize-"+("lg"===a?"lg":"sm"===a?"sm":"xs"),this.pe.ojListView("refresh"))},VMa:function(a){"string"!==
typeof a||a===this.FO||"auto"!==a&&"off"!==a||(this.FO=a,this.pe.ojListView("refresh"))},WMa:function(a){"string"===typeof a&&a!==this.Lf&&(this.Lf=a,this.vMa(),this.pe.ojListView("refresh"))},vMa:function(){var a="grid"===this.Lf,c=a?"oj-colorpalette-grid":"oj-colorpalette-list";this.pe.removeClass("oj-colorpalette-grid oj-colorpalette-list oj-listview-card-layout");this.pe.addClass(c);a&&this.pe.addClass("oj-listview-card-layout")},Pja:function(b,c,e){this.pxa(b);this.cC=new a.Xa(b,{idAttribute:"id"});
0<=c&&(0===this.SO.length?this.SO.push(c):this.SO[0]=c);e&&this.pe.ojListView("option","data",this.cC)},oHa:function(){this.DP("Palette (id\x3d"+this.element.attr("id")+") is initializing.");this.JG();this.hb()},hb:function(){this.Sg.append(this.bH);this.Sg.addClass("oj-colorpalette");this.B7=this.Sg.find(".oj-colorpalette-container");this.pe=this.B7.find(":first");this.pe.attr("data-oj-context","");this.Af&&this.Af instanceof a.o&&(this.im=this.LX(this.Af));this.Vka=0;this.Pja(this.nn,this.im,!1);
this.pe.ojListView({data:this.cC,item:{renderer:this.DLa.bind(this)},optionChange:this.DJa.bind(this),selectionMode:"single",selection:this.SO,rootAttributes:{style:"height:100%;width:100%"}}).attr("data-oj-internal","");var b=this;a.Context.getContext(this.pe[0]).ye().whenReady().then(function(){b.pe.ojListView("option","translations.msgNoData","");b.YH(b.jq);if(b.pe[0].scrollWidth>b.pe[0].clientWidth){var a=b.cEa(),c="rtl"===b.sd();b.pe.css(c?"padding-left":"padding-right",a+1)}b.I0()})},JG:function(){this.TV();
this.iba=a.Ka.dl(a.Vh.CONVERTER_TYPE_COLOR);this.QW=this.iba.createConverter({format:"hex"});this.R("labelNone");this.bH=["\x3cdiv class\x3d'oj-colorpalette-container'\x3e","\x3cul class\x3d'"+("grid"===this.Lf?"oj-colorpalette-grid oj-listview-card-layout":"oj-colorpalette-list")+"'/\x3e","\x3c/div\x3e"].join("")},TV:function(){var b=this.options,d;this.Sg=c(this.element);this.jq=!1;this.SO=[];this.cC=null;d=b.swatchSize;"string"===typeof d&&(d=d.toLowerCase(),"lg"!==d&&"sm"!==d&&"xs"!==d&&(d="lg"));
this.wC=d;this.Uka="oj-colorpalette-swatchsize-"+d;d=b.labelDisplay;"string"===typeof d&&(d=d.toLowerCase(),"auto"!==d&&"off"!==d&&(d="auto"));this.FO=d;d=b.layout;"string"===typeof d&&(d=d.toLowerCase(),"grid"!==d&&"list"!==d&&(d="grid"),"grid"!==d&&"xs"===this.wC&&(d="grid"));this.Lf=d;d=b.value;d instanceof a.o||(d=null);this.Af=d?d:a.o.BLACK;d=b.palette;c.isArray(d)||(d=[]);this.nn=d.slice(0);d=b.disabled;"boolean"===typeof d&&(this.jq=d)},oIa:function(a){var c=a.hD(),e=a.$C(),f=a.YC();a=a.XC();
return 0===c&&0===e&&0===f&&0===a},iIa:function(a,c){var e=a.length,f=c.length,g,k;g=!1;if(e===f){for(f=0;f<e&&(g=a[f],k=c[f],!this.sM(g.color,k.color)||(g=g.label,k=k.label,g===k));f++);g=f>=e}return g},pxa:function(a){var c,e,f=a.length;for(c=0;c<f;c++)e=a[c],e.id=this.dea()},dea:function(){var a=this.Vka.toString();this.Vka++;return a},Ax:function(){this.iba=this.QW=this.bH=this.pe=null},cEa:function(){var a=c("\x3cdiv style\x3d'overflow: scroll; width: 100px; height: 100px; position: absolute; visibility: hidden;'\x3e\x3cdiv style\x3d'width: 100%; height: 100%;'\x3e\x3c/div\x3e\x3c/div\x3e");
this.element.append(a);var d=a[0].offsetWidth,e=a.children()[0].offsetWidth;a.remove();return d-e},_GetMessagingLauncherElement:function(){return this.element},cg:function(){return this.pe},fu:function(){return this.Af},Jj:function(b){this.Af="string"===typeof b?new a.o(b):b},ji:function(){return this.Af.toString()},_GetDefaultStyleClass:function(){return"oj-colorpalette"}})})()});