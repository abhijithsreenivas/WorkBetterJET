/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojdnd","ojs/ojlistview"],function(a,g){a.jb=function(a){this.Ia=a};o_("ListViewDndContext",a.jb,a);a.f.xa(a.jb,a.f,"oj.ListViewDndContext");a.jb.ssa=67;a.jb.VT=86;a.jb.XT=88;a.jb.prototype.reset=function(){this.h2();this.Nn=this.mJ=this.rJ=this.OR=null};a.jb.prototype.mY=function(a){var b=this.Ia.Nd("dnd");return null!=b&&b[a]?b[a].items:null};a.jb.prototype.nN=function(){return this.mY("drag")};a.jb.prototype.nY=function(){return this.mY("drop")};a.jb.prototype.Hs=
function(){return"enabled"==this.mY("reorder")};a.jb.prototype.bh=function(a){return this.Ia.fo(a)};a.jb.prototype.KN=function(){var a,b,d,e;a=[];if(this.Ia.Rc())for(b=this.Ia.Nd("selection"),d=0;d<b.length;d++)e=this.Ia.We(b[d]),null==e||this.Ia.Gj(g(e))||a.push(e);else e=this.Zca(),null!=e&&a.push(e);null!=this.uz&&0<this.uz.length&&-1==a.indexOf(this.uz.get(0))&&a.push(this.uz.get(0));return a};a.jb.prototype.Zca=function(){return null==this.Ia.V?null:this.Ia.V.elem[0]};a.jb.prototype.rz=function(a){var b;
g(a).hasClass(this.Ia.kg())||(a=a.firstElementChild);a=g(a).find(".oj-listview-drag-handle");null!=a&&0<a.length&&(b=a.attr("aria-labelledby"),null==b?a.attr("aria-labelledby",this.Ia.Dx("instr")):a.attr("aria-labelledby",b+" "+this.Ia.Dx("instr")),this.Ia.ln()&&a.attr("draggable","true"))};a.jb.prototype.h2=function(){this.qpa&&g.each(this.qpa,function(a,b){g(b).removeClass("oj-draggable")})};a.jb.prototype.XUa=function(){var a=[],b,d,e;this.h2();b=this.Ia.Nd("selection");for(d=0;d<b.length;d++)e=
this.Ia.We(b[d]),null==e||this.Ia.Gj(g(e))||(a.push(e),g(e).addClass("oj-draggable"));this.qpa=a};a.jb.prototype.Wja=function(a){var b;b=a.find(".oj-listview-drag-handle");if(null!=b&&0<b.length)return!0;a.addClass("oj-draggable");return!1};a.jb.prototype.vOa=function(a){a.removeClass("oj-draggable")};a.jb.prototype.Sja=function(a){var b,d;if(null!=this.nN()||this.Hs()){if(a.hasClass("oj-listview-drag-handle"))b=g(a);else{a=this.bh(a);if(null!=a&&(d=this.Wja(a)))return;d=this.KN();0<d.length&&(null!=
a&&-1<d.indexOf(a[0])?b=a:g(d[0]).removeClass("oj-draggable"))}null!=b&&b.attr("draggable",!0)}};a.jb.prototype.yla=function(a){if(null!=this.nN()||this.Hs())a=a.hasClass("oj-listview-drag-handle")?g(a):this.bh(a),null!=a&&a.removeAttr("draggable")};a.jb.prototype.Po=function(c,b,d,e){var f;if(c="drag"===c?this.nN():this.nY())if((b=c[b])&&"function"==typeof b)try{d.dataTransfer=d.originalEvent.dataTransfer,f=b(d,e)}catch(g){a.C.error("Error: "+g)}else return-1;return f};a.jb.prototype.yMa=function(a,
b,d){var e,f=[],g;for(e=0;e<d.length;e++)(g=this.Ia.pda(d[e]))&&(g.innerHTML&&g.tagName&&"LI"==g.tagName?f.push(g.innerHTML):f.push(g));return 0<f.length?(this.xMa(a.originalEvent,b,f),this.zMa(a.originalEvent,d),{items:f}):null};a.jb.prototype.xMa=function(a,b,d){var e;a=a.dataTransfer;d=JSON.stringify(d);if("string"==typeof b)a.setData(b,d);else if(b)for(e=0;e<b.length;e++)a.setData(b[e],d);a.setData("text/ojlistview-dragsource-id",this.Ia.element.get(0).id)};a.jb.prototype.zMa=function(a,b){var d,
e,f=Number.MAX_VALUE,h,k,l,m=0,p=0;d=a.target;if(1<b.length){d=g(document.createElement("ul"));d.get(0).className=this.Ia.element.get(0).className;d.addClass("oj-listview-drag-image").css({width:this.Ia.element.css("width"),height:this.Ia.element.css("height")});for(e=0;e<b.length;e++)f=Math.min(f,b[e].offsetTop);for(e=0;e<b.length;e++)h=b[e].offsetTop-f,k=b[e].offsetWidth,l=g(b[e].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").css({position:"absolute",top:h,width:k}),d.append(l)}else g(d).hasClass("oj-listview-drag-handle")&&
(h=0,g.contains(b[0],d.offsetParent)&&(h=d.offsetTop),m=Math.max(0,d.offsetLeft-b[0].offsetLeft)+d.offsetWidth/2,p=h+d.offsetHeight/2),l=g(b[0].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").addClass("oj-drag"),d=g(document.createElement("ul")),d.get(0).className=this.Ia.element.get(0).className,d.addClass("oj-listview-drag-image").css({width:this.Ia.element.css("width"),height:2*b[0].offsetHeight}).append(l);g("body").append(d);this.rJ=d;a.dataTransfer.setDragImage(d.get(0),m,p)};
a.jb.prototype.xZ=function(a){var b,d,e;b=this.nN();if(null!=b||this.Hs())if(d=null!=b?b.dataTypes:"text/ojlistview-items-data",g(a.target).hasClass("oj-listview-drag-handle")?(e=[],e.push(this.bh(a.target)[0])):e=this.KN(),0<e.length){if(null==b&&1<e.length)return!1;this.Nn=e;this.mJ=g(e[0]);if(b=this.yMa(a,d,e)){if(a=this.Po("drag","dragStart",a,b),-1!==a)return a}else return!1}};a.jb.prototype.ZEa=function(a){return this.Po("drag","drag",a)};a.jb.prototype.IM=function(){null!=this.rJ&&(this.rJ.remove(),
this.rJ=null)};a.jb.prototype.tZ=function(a){var b;if(null!=this.mJ&&null!=this.Nn)for(this.mJ.find(".oj-listview-drag-handle").removeAttr("draggable"),this.mJ.removeClass("oj-drag oj-draggable").removeAttr("draggable"),b=0;b<this.Nn.length;b++)g(this.Nn[b]).removeClass("oj-listview-drag-item");this.BF();this.IM();this.h2();this.Po("drag","dragEnd",a);this.OR=this.Nn;this.Nn=this.mJ=this.rJ=null};a.jb.prototype.H_=function(a){var b,d;b=this.nY();if(this.Hs()&&null==b)return!0;if(b&&b.dataTypes)for(b=
b.dataTypes,b="string"==typeof b?[b]:b,a=a.originalEvent.dataTransfer.types,d=0;d<a.length;d++)if(0<=b.indexOf(a[d]))return!0;return!1};a.jb.prototype.Qo=function(a,b,d){a=this.Po("drop",a,b,d);(void 0===a||-1===a)&&this.H_(b)&&b.preventDefault();return a};a.jb.prototype.kba=function(a){var b;null==this.$j&&(b=g(a.get(0).cloneNode(!1)),b.addClass("oj-drop").removeClass("oj-drag oj-draggable oj-hover oj-focus oj-selected").css({display:"block",height:a.outerHeight()}),this.$j=b);return this.$j};a.jb.prototype.Eaa=
function(){null!=this.qj&&-1===this.ED&&this.qj.children("."+this.Ia.jg()).removeClass("oj-drop")};a.jb.prototype.Daa=function(){null!=this.qj&&this.qj.hasClass("oj-listview-no-data-message")&&(this.qj.removeClass("oj-drop"),this.qj.get(0).textContent=this.Ia.vda())};a.jb.prototype.BF=function(){null!=this.$j&&(this.$j.css("height","0"),this.$j.remove(),this.$j=null);this.Daa();this.Eaa()};a.jb.prototype.uZ=function(a){var b;b=this.bh(a.target);a=this.Qo("dragEnter",a,{item:b.get(0)});if(-1!=a)return a};
a.jb.prototype.Y0=function(a){null!=this.qj&&this.qj.removeClass("oj-valid-drop oj-invalid-drop");this.qj=a;this.qj.addClass("oj-valid-drop")};a.jb.prototype.Ija=function(a,b){var d;d=a.attr("aria-label");null==d&&(d=a.text());d=this.Ia.ea.R("accessibleReorder"+b.charAt(0).toUpperCase()+b.substr(1)+"Item",{item:d});this.Ia.Jh(d)};a.jb.prototype.Hxa=function(){null==this.Mpa&&this.Ia.ln()&&(this.Ia.element.find("ul."+this.Ia.nh()).each(function(){g(this).attr("oldMaxHeight",g(this).css("maxHeight").toString());
g(this).css("maxHeight",1E4)}),this.Mpa="adjusted")};a.jb.prototype.uja=function(){this.Ia.ln()&&this.Ia.element.find("ul."+this.Ia.nh()).each(function(){g(this).css("maxHeight",parseInt(g(this).attr("oldMaxHeight"),10));g(this).removeAttr("oldMaxHeight")});this.Mpa=null};a.jb.prototype.wZ=function(a){var b,d,e,f;if(null!=this.nY()||this.Hs()){this.Hxa();if(null!=this.Nn&&"none"!=g(this.Nn[0]).css("display")){b=g(this.Nn[0]);d=this.kba(b);for(a=0;a<this.Nn.length;a++)g(this.Nn[a]).addClass("oj-listview-drag-item");
d.insertBefore(b);this.ED=d.index()}else b=this.bh(a.target),null!=b&&0<b.length?(e=this.Qo("dragOver",a,{item:b.get(0)}),-1===e&&this.Hs()||!1===e||a.isDefaultPrevented()?(b.hasClass(this.Ia.kg())?(this.Eaa(),b.hasClass("oj-drop")||(d=this.kba(b),f=b.index(),null==this.ED||this.ED<f?(d.insertAfter(b),this.DD="after"):(d.insertBefore(b),this.DD="before"),this.Ija(b,this.DD),this.Y0(b),this.ED=d.index())):(this.BF(),b.children("."+this.Ia.jg()).addClass("oj-drop"),this.Y0(b),this.ED=-1,this.DD="inside",
this.Ija(b,this.DD)),a.preventDefault()):g(a.target).hasClass(this.Ia.nh())||(b.addClass("oj-invalid-drop"),this.BF())):(b=this.Ia.element.children(".oj-listview-no-data-message"),null!=b&&0<b.length&&(b.addClass("oj-drop"),b.get(0).textContent="",this.Y0(b),a.preventDefault()));return e}};a.jb.prototype.rO=function(a,b){var d,e;d=b.getBoundingClientRect();e=a.originalEvent;return e.clientX>=d.left&&e.clientX<d.right&&e.clientY>=d.top&&e.clientY<d.bottom};a.jb.prototype.vZ=function(a){var b,d;if(null!=
this.qj&&(b=this.bh(a.target),null!=b&&0<b.length?(b.removeClass("oj-valid-drop oj-invalid-drop"),d=this.Qo("dragLeave",a,{item:b.get(0)}),this.rO(a,a.currentTarget)||(this.BF(),this.uja())):this.rO(a,a.currentTarget)||this.Daa(),-1!=d))return d};a.jb.prototype.yZ=function(a){var b,d;if(null!=this.qj&&(b=a.originalEvent.dataTransfer.getData("text/ojlistview-dragsource-id"),d=this.qj.hasClass("oj-listview-no-data-message")?{}:{item:this.qj.get(0),position:this.DD},this.Hs()&&b===this.Ia.element.get(0).id?
d.reorder=!0:d.reorder=!1,b=this.Qo("drop",a,d),d.reorder&&(d.items=null==this.OR?this.Nn:this.OR,d.reference=d.item,this.Ia.Kl("reorder",a,d),a.preventDefault()),null!=this.qj&&this.qj.removeClass("oj-valid-drop"),this.BF(),this.uja(),this.IM(),this.qj=null,this.ED=-1,this.OR=this.DD=null,-1!==b))return b};a.jb.prototype.ZOa=function(a){var b=this,d,e;this.Hs()&&(void 0==a&&(a=this.Ia.Nd("contextMenu")),null!=a&&(null==this.Qn&&(this.Qn=[]),a=g(a),d=a.find("[data-oj-command]"),e=[],d.each(function(){var a,
c;0===g(this).children("a").length?0==g(this).attr("data-oj-command").indexOf("oj-listview-")&&(a=g(this).attr("data-oj-command").substring(12),c=b.Ak(a),c.get(0).className=g(this).get(0).className,g(this).replaceWith(c)):(a=g(this).attr("data-oj-command"),"pasteBefore"==a?a="paste-before":"pasteAfter"==a&&(a="paste-after"));null!=a&&e.push(a)}),this.Qn=e,0<e.length&&(a.data("oj-ojMenu")&&a.ojMenu("refresh"),a.on("ojbeforeopen",this.QEa.bind(this)),a.on("ojselect",this.hm.bind(this)))))};a.jb.prototype.Ak=
function(a){return"paste-before"===a?this.Zg("pasteBefore"):"paste-after"===a?this.Zg("pasteAfter"):this.Zg(a)};a.jb.prototype.Zg=function(a){var b=g("\x3cli\x3e\x3c/li\x3e");b.attr("data-oj-command",a);b.append(this.vF(a));return b};a.jb.prototype.vF=function(a){a="label"+a.charAt(0).toUpperCase()+a.slice(1);return g('\x3ca href\x3d"#"\x3e\x3c/a\x3e').text(this.Ia.ea.R(a))};a.jb.prototype.zG=function(a){var b;null!=this.rp&&g(this.rp).removeClass("oj-listview-cut");b=this.KN();g(b).addClass("oj-listview-cut");
this.rp=b;this.Ia.Kl("cut",a,{items:b})};a.jb.prototype.bfa=function(a){var b;null!=this.rp&&g(this.rp).removeClass("oj-listview-cut");this.rp=b=this.KN();this.Ia.Kl("copy",a,{items:b})};a.jb.prototype.BG=function(a,b,d){this.Ia.Kl("paste",a,{item:b.get(0)});g(this.rp).removeClass("oj-listview-cut");this.Ia.Kl("reorder",a,{items:this.rp,position:d,reference:b.get(0)});this.rp=null};a.jb.prototype.hm=function(a,b){if(null!=this.uz)switch(b.item.attr("data-oj-command")){case "cut":this.zG(a);break;
case "copy":this.bfa(a);break;case "paste":var d=!0;case "pasteBefore":var e=!0;case "pasteAfter":var f="after";d?f="inside":e&&(f="before");this.BG(a,this.uz,f);this.uz=null}};a.jb.prototype.mF=function(a,b){null!=this.Qn&&("paste-before"==b?b="pasteBefore":"paste-after"==b&&(b="pasteAfter"),a.find("[data-oj-command\x3d'"+b+"']").removeClass("oj-disabled"))};a.jb.prototype.QEa=function(a,b){var d,e;d=g(a.target);d.find("[data-oj-command]").addClass("oj-disabled");e=b.openOptions.launcher;null==e||
null==this.Qn||0==this.Qn.length?d.ojMenu("refresh"):(e.children().first().hasClass(this.Ia.jg())?null!=this.rp&&this.mF(d,"paste"):(this.mF(d,"cut"),this.mF(d,"copy"),null!=this.rp&&(this.mF(d,"paste-before"),this.mF(d,"paste-after"))),d.ojMenu("refresh"),this.uz=e)};a.jb.prototype.lK=function(c){var b,d;if(!this.Hs()||null==this.Qn||0==this.Qn.length)return!1;if(c.ctrlKey||c.metaKey){b=c.keyCode;if(b===a.jb.XT&&-1<this.Qn.indexOf("cut"))return this.zG(c),!0;if(b===a.jb.ssa&&-1<this.Qn.indexOf("copy"))return this.bfa(c),
!0;if(b===a.jb.VT&&null!=this.rp&&(b=g(this.Zca()),b.children().first().hasClass(this.Ia.jg())?-1<this.Qn.indexOf("paste")&&(d="inside"):-1<this.Qn.indexOf("paste-before")?d="before":-1<this.Qn.indexOf("paste-after")&&(d="after"),null!=d))return this.BG(c,b,d),!0}return!1}});