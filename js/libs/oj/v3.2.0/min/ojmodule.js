/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","promise"],function(a,g){a.Zt={};a.Zt.td={viewPath:"text!views/",viewSuffix:".html",modelPath:"viewModels/",initializeMethod:"initialize",disposeMethod:"dispose",activatedHandler:"handleActivated",attachedHandler:"handleAttached",detachedHandler:"handleDetached",bindingsAppliedHandler:"handleBindingsApplied",deactivatedHandler:"handleDeactivated",transitionCompletedHandler:"handleTransitionCompleted"};o_("ModuleBinding.defaults",a.Zt.td,a);a.Zt.vua="oj:blank";(function(){function c(b,
c,e,f,h,k,l){var n=c.canAnimate;if(null==n||n.call(c,b)){var s,t;if(n=c.prepareAnimation.call(c,b))s=n.newViewParent,t=n.oldViewParent;var E=s||e;t&&t!==e?d(f,t):E===e&&k(null);E!==e&&g.virtualElements.setDomNodeChildren(E,[]);h(E);var C=Array.prototype.slice.call(E.childNodes),F=!1,K=function(){F||(F=!0,e!==E&&(m(e,C),a.Components&&(p(C,a.Components.og),p(C,a.Components.nf))))},B=k.bind(null,t);b.newViewParent=s;b.oldViewParent=t;b.oldViewNodes=f;b.removeOldView=B;b.insertNewView=K;var D=function(){B();
K();l()};return c.animate.call(c,b).then(D,function(){D();a.C.error("ojModule animation promise was rejected")})}}function b(a,b,c){b=b||a;var d=[];c&&a===b&&(c.parentNode.removeChild(c),d.push(c));g.virtualElements.setDomNodeChildren(b,d)}function d(a,b){a.forEach(function(a){b.appendChild(a)})}function e(a,b,c){if(a&&a[b]){var d={element:c[0],valueAccessor:c[1]};2<c.length&&(d.viewModel=c[2],3<c.length&&(d["boolean"===typeof c[3]?"fromCache":"cachedNodes"]=c[3]));return g.ignoreDependencies(a[b],
a,[d])}}function f(b,c,d){if(null!=b&&(c=a.Zt.td[c],null!=c&&b&&(c=b[c],"function"===typeof c))){var e=void 0;d&&(e={element:d[0],valueAccessor:d[1]},2<d.length&&(e["boolean"===typeof d[2]?"fromCache":"cachedNodes"]=d[2]));return g.ignoreDependencies(c,b,[e])}}function h(a,b,c){var d=[];for(a=g.virtualElements.firstChild(a);null!=a&&a!=c;a=a.nextSibling)a!=b&&d.push(a);return d}function k(a,b){var c=[],d=g.virtualElements.firstChild(a);l(d,b,function(a){c.push(a)});return c}function l(a,b,c){for(;null!=
a;){var d=g.virtualElements.nextSibling(a),e=a.nodeType;a===b||1!==e&&8!==e||c(a);a=d}}function m(a,b){for(var c=b.length-1;0<=c;c--)g.virtualElements.prepend(a,b[c])}function p(a,b){if(b)for(var c=0;c<a.length;c++)b(a[c])}function t(a,b){if("string"===typeof a)a=g.utils.parseHtmlFragment(a);else if(window.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType)a=g.utils.arrayPushAll([],a.childNodes);else if(Array.isArray(a))a=g.utils.arrayPushAll([],a);else throw b(),"The View ("+a+") has an unsupported type";
return a}function s(b,c){b=b?b:require;return new Promise(function(d,e){b([c],function(a){d(a)},function(b){a.C.error("ojModule failed to load "+c);e(b)})})}function n(a){return a?new Promise(function(b){a.then(b,b)}):a}g.bindingHandlers.ojModule={init:function(r,q,u,v,w){function y(a){if(a!=F)throw L;}function x(a){f(a,"disposeMethod",[r,q])}function z(){D&&(D(),D=null)}var A,H,E={},C,F=-1,K,B,D,G;g.utils.domNodeDisposal.addDisposeCallback(r,function(){x(A);for(var a=Object.keys(E),b=0;b<a.length;b++)x(E[a[b]].Xn);
z()});var L=Error("Promise cancelled because ojModule is fetching new View and ViewModel"),J=r;8===r.nodeType&&(J=r.parentElement,g.virtualElements.setDomNodeChildren(r,[]),B=r.nextSibling);g.computed(function(){F++;D||(D=a.Context.getContext(J).ye().Ed({description:"ojModule binding on a node with the Id "+r.id+"is loading the module. Binding evaluator: "+q.toString()}));var u=0===F,v=g.utils.unwrapObservable,O=v(q()),X,Z,ga,ea,S,ia,U,ka,fa,aa,W,Q,N;"string"===typeof O?X=O:(X=v(O.name),Z=v(O.viewName),
ga=v(O.params),ea=v(O.viewModelFactory),S=v(O.createViewFunction),ia=v(O.cacheKey),U=v(O.lifecycleListener),ka=v(O.animation),Q=v(O.view),N=v(O.viewModel),fa=v(O.require));null==fa||fa instanceof Function||(W=fa.viewPath,aa=fa.modelPath,fa=fa.instance);Z=null==Z?X:Z;var M=a.Zt.vua===Z,v=e(U,"activated",[r,q]),I,Y;if(M)I=Promise.resolve([]),Y=Promise.resolve(null);else{var ba=null==ia?null:E[ia];null!=ba&&(delete E[ia],I=Promise.resolve(ba.view),Y=Promise.resolve(ba.Xn))}null==I&&null!=Q&&(I=Promise.resolve(Q));
if(null==Y&&(null!=N?Y=Promise.resolve(N):null!=ea&&(Y=g.ignoreDependencies(ea.createViewModel,ea,[ga,q])),null==Y&&null!=X&&(null==aa&&(aa=a.Zt.td.modelPath),Y=s(fa,aa+X)),null!=Y&&(Y=Y.then(function(a,b){y(a);return b="function"===typeof b?new b(ga):f(b,"initializeMethod",[r,q])||b}.bind(null,F)),null==I&&null!=S&&(I=Y.then(function(a,b){y(a);if(null==b)throw z(),"createViewFunction option cannot be used when the ViewModel is null";var c=b[S];if(null==c)throw z(),"function specified by the createViewFunction option was not found on the ViewModel";
return c.call(b)}.bind(null,F)))),null==I))if(null!=Z)null==W&&(W=a.Zt.td.viewPath),I=s(fa,W+Z+a.Zt.td.viewSuffix);else throw z(),Error("View name or view instance must be specified");if(null==I)throw z(),Error("ojModule is missing a View");var V;null!=Y&&(V=Y.then(function(a,b){y(a);return f(b,"activatedHandler",[r,q])}.bind(null,F)));Promise.all([I,Y,v,V,H]).then(function(s,v){if(s==F){var y=v[0];if(null==y)throw z(),"The module's View was resolved to null";var D=t(y,z),T=v[1],J=!1,L,I=h(r,K,B),
N=k(r,K);null==C||G||(J=!0,L=I,K||(K=document.createElement("div"),K.className="oj-helper-module-cache",g.virtualElements.prepend(r,K)));var O=!1,y=function(c){O||(O=!0,J?d(I,K):N.forEach(function(a){g.cleanNode(a)}),b(r,c||r,K),u||(e(U,"detached",[r,q,A,L]),f(A,"detachedHandler",[r,q,L]),e(U,"deactivated",[r,q,A]),f(A,"deactivatedHandler",[r,q])),J?(p(L,a.Components?a.Components.yr:null),E[C]={Xn:A,view:L}):x(A),A=T,C=ia,G=M)},Q=function(b){b=b||r;m(b,D);var c=null!=ba;c&&p(D,a.Components?a.Components.zr:
null);e(U,"attached",[b,q,T,c]);f(T,"attachedHandler",[b,q,c]);if(!c){var d=w.createChildContext(T,void 0,function(a){a.$module=T;a.$params=ga});l(D[0],K,function(a){g.applyBindings(d,a)});e(U,"bindingsApplied",[b,q,T]);f(T,"bindingsAppliedHandler",[b,q])}},R=function(){e(U,"transitionCompleted",[r,q,T]);f(T,"transitionCompletedHandler",[r,q]);z()};if(null!=ka){var S=c({node:r,valueAccessor:q,isInitial:u,oldViewModel:A,newViewModel:T},ka,r,I,Q,y,R);H=n(S)}else H=void 0;H||(y(null),Q(null),R())}}.bind(null,
F),function(b,c){c!==L&&null!=c&&(z(),a.C.error(c))}.bind(null,F))},null,{disposeWhenNodeIsRemoved:r});return{controlsDescendantBindings:!0}}};g.virtualElements.allowedBindings.ojModule=!0})()});