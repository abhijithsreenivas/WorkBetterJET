/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","promise","ojs/ojcustomelement","ojs/ojcomposite-knockout"],function(a){a.Kb={};a.Kb.ur=Object.create(a.ia.ur);a.vc.fe(a.Kb.ur,{OS:function(b){b.setProperty=function(b,c){if(a.ld.UC(b))this[b]=c;else{var f=this.getProperty(b),g=a.ia.lc(this),k=a.ia.gD(g),l=b.split("."),m=a.ia.dF(b,k);if(m||1!=l.length){if(k[l[0]].readOnly)throw"Read-only property "+b+" cannot be set on "+this.tagName;a.ia.cF(this,b,c,m);a.ia.QL(g.bA.bind(g),this,b,c);g.n9&&-1!==b.indexOf(".")&&a.Kb.TX(this,b,
c,f,"external")}else a.C.error("Ignoring property set for undefined property "+b+" on "+this.tagName)}};b.getProperty=function(b){var c=a.ld.UC(b);return c?c:-1!==b.indexOf(".")?a.ia.c$(this,b):this[b]};b._propsProto.setProperty=function(b,c){var f=this.getProperty(b),g=a.ia.dF(b,a.ia.gD(this.uA));g||-1!==b.indexOf(".")?(a.ia.cF(this.Yw,b,c,g),a.ia.QL(this.uA.bA.bind(this.uA),this,b,c),-1!==b.indexOf(".")&&a.Kb.TX(this.Yw,b,c,f,"internal")):a.C.error("Ignoring property set for undefined property "+
b+" on "+this.Yw.tagName)};b._propsProto.getProperty=function(b){return-1!==b.indexOf(".")?a.ia.c$(this,b):this[b]};b.getNodeBySubId=function(b){var c=a.ia.lc(this);return c.rx.getNodeBySubId?c.rx.getNodeBySubId(b,c.fea.bind(this)):c.fea.bind(this)(b)};b.getSubIdByNode=function(b){var c=a.ia.lc(this);return c.rx.getSubIdByNode?c.rx.getSubIdByNode(b,c.Dea.bind(this)):c.Dea.bind(this)(b)}},aT:function(b,c,e){b[c]=function(){var b=e.internalName||c,g=a.ia.lc(this);return g.rx[b].apply(g.rx,arguments)}},
bT:function(b,c,e){function f(a){g.bind(this)(a,!1)}function g(b,f){var h=a.Kb.RY(this.uA,c),p=h.peek();p!==b&&(a.ia.cF(this.Yw,c,b,e),h(b),e.ZM&&(h=a.ld.UC(c),p&&this.Yw.removeEventListener(h,p),b&&b instanceof Function&&this.Yw.addEventListener(h,b)),!e.lX&&(!f||f&&this.uA.n9)&&a.Kb.TX(this.Yw,c,b,p,f?"external":"internal"))}e.lX||a.Kb.Mba(b._propsProto,c,function(){var b=a.Kb.RY(this.uA,c)();return null==b?e.value:b},f);a.Kb.Mba(b,c,function(){var b=a.ia.lc(this),b=a.Kb.RY(b,c).peek();return null==
b?e.value:b},function(b){if(e.readOnly)throw"Read-only property "+c+" cannot be set on "+this.tagName;var f=a.ia.lc(this);g.bind(f.Yp)(b,!0)})},pE:function(a){return a._metadata},sT:function(b){a.ia.d$(b,this.Yp,a.ia.gD(this),this.xK);this.kT().Mz()},tT:function(b,c){if(this.cx){var e=this;this.Sta=this.cx.then(function(b){return a.Uh.tD(b,"activatedMethod",[e.zV])})}this.ZU.Mz(this.Yp);var f={},g=a.Uh.cQa(b),k;for(k in g)f[k]=g[k].length;this.uwa=g;this.t9.Mz(f);e=this;Promise.all([this.Qwa,this.cx,
this.ZU.UI(),this.fua,this.Sta]).then(function(g){g=g[0];if(!g)throw"ojComposite is missing a View";a.Uh.sUa({props:e.Yp,fVa:e.uwa,gVa:f,unique:e.zV.unique,ww:e.rx,esa:e.zV},b,g,c);e.n9=!0;e.oE().Mz();a.Kb.Jx("ready",b)})},B6:function(b){this.cx&&this.cx.then(function(c){a.Uh.tD(c,"disposeMethod",[b])})},uT:function(b){a.Kb.Jx("pending",b);var c=a.ia.CV(b.tagName);if(!c)throw"Composite is missing a descriptor";this.Qw=this.pE(c);this.xK=c.parseFunction;b._propsProto&&(this.Yp=Object.create(b._propsProto),
this.Yp.uA=this,this.Yp.Yw=b);this.ZU=new a.ia.NL;this.t9=new a.ia.NL;var e={element:b,props:this.ZU.UI(),slotNodeCounts:this.t9.UI(),unique:a.Kb.oEa()};this.zV=e;if(b=a.Kb.FN(c,"viewModel")){var f=this;this.cx=b.then(function(b){b="function"===typeof b?new b(e):a.Uh.tD(b,"initializeMethod",[e])||b;return f.rx=b})}if(b=a.Kb.FN(c,"view"))this.Qwa=b.then(function(b){return a.Kb.SCa(b)});if(c=a.Kb.FN(c,"css"))this.fua=c.then(function(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?
b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.head.appendChild(b)})},vT:function(b){this.cx&&this.cx.then(function(c){a.Uh.tD(c,"detachedMethod",[b])})},F6:function(a){Object.defineProperty(a,"_propsProto",{value:{}})},fea:function(b){var c=a.Kb.Uwa(this)[b.subId];return c?c.alias?(b=a.vc.fe({},b,void 0,!0),b.subId=c.alias,c=c.node,c.getNodeBySubId?c.getNodeBySubId(b):a.Components.nd(c)("getNodeBySubId",b)):c.node:null},Dea:function(b){if(!this.contains(b))return null;
var c=a.Kb.Twa(this),e=a.vh.rna(b,this);if(null!=e){var f=e.Cm.getAttribute("data-oj-subid-map");return(c=c[f])&&e.getSubIdByNode&&(b=e.getSubIdByNode(b))?(b.subId=c.map[b.subId],b):null}for(e=b;e!==this&&!(f=e.getAttribute("data-oj-subid-map")||e.getAttribute("data-oj-subid"));)e=e.parentNode;if(c=c[f])if(c.map){if(f=c.node,b=f.getSubIdByNode?f.getSubIdByNode(b):a.Components.nd(f)("getSubIdByNode",b))return b.subId=c.map[b.subId],b}else return{subId:f};return null}});a.Kb.register=function(b,c){a.ia.g$(b,
c,a.Kb.ur)&&a.Kb.getMetadata(b).then(function(e){var f=e.name;f?b!=f&&a.C.warn("Registered property tagName: %s does not match name: %s provided in metadata.",b,f):a.C.warn('Required property "name" missing from metadata for %s.',b);e.version||a.C.warn('Required property "version" missing from metadata for %s.',b);e.jetVersion||a.C.warn('Required composite "jetVersion" missing from metadata for %s.',b);c._metadata=a.ia.f$(e,!1);document.registerElement(b.toLowerCase(),{prototype:a.Kb.ur.Qna(c)})})};
a.Kb.getMetadata=function(b){var c=a.ia.CV(b);if(c){var e=c._metadataPromise;e||(e=a.Kb.FN(c,"metadata"),e||(a.C.warn("Required metadata is missing for "+b),e=Promise.resolve({})),c._metadataPromise=e);return e}return null};a.Kb.Mba=function(a,c,e,f){Object.defineProperty(a,c,{enumerable:!0,get:e,set:f})};a.Kb.Jx=function(a,c){c.dispatchEvent(new CustomEvent(a,{bubbles:!0}))};a.Kb.TX=function(a,c,e,f,g){var k={},l=c.split("."),m=c,p=e,t=f;1<l.length&&(m={},m.path=c,m.value=e,m.previousValue=f,k.subproperty=
m,m=l[0],t=p=a[m]);k.value=p;k.previousValue=t;k.updatedFrom=g;a.dispatchEvent(new CustomEvent(m+"-changed",{detail:k}));a.dispatchEvent(new CustomEvent(m+"Changed",{detail:k}))};a.Kb.SCa=function(b){if("string"===typeof b){var c=document.createElement("div");c.innerHTML=b;b=[];for(var e=0;e<c.childNodes.length;e++)b.push(c.childNodes[e]);return b}if(a.Kb.QHa(b)){c=b.cloneNode(!0);b=[];for(e=0;e<c.childNodes.length;e++)b.push(c.childNodes[e]);return b}if(Array.isArray(b)){c=[];for(e=0;e<b.length;e++)c.push(b[e].cloneNode(!0));
return c}throw"The View ("+b+") has an unsupported type";};a.Kb.Xca=function(b,c){if(!b.v9){for(var e={},f={},g=c.children,k=0;k<g.length;k++)a.Kb.Ola(e,f,g[k]);b.Bva=f;b.v9=e}};a.Kb.Ola=function(b,c,e){if(!e.hasAttribute("slot")&&(a.Kb.yxa(b,c,e),!a.ia.Rv(e.tagName)&&!a.Components.nd(e))){e=e.children;for(var f=0;f<e.length;f++)a.Kb.Ola(b,c,e[f])}};a.Kb.yxa=function(a,c,e){var f=e.getAttribute("data-oj-subid"),g=e.getAttribute("data-oj-subid-map");if(g){if(f=JSON.parse(g),"object"===typeof f&&!(f instanceof
Array)){var k={},l;for(l in f)a[l]={alias:f[l],node:e},k[f[l]]=l;c[g]={map:k,node:e}}}else f&&(a[f]={node:e},c[f]={node:e})};a.Kb.Uwa=function(b){var c=a.ia.lc(b);a.Kb.Xca(c,b);return c.v9};a.Kb.Twa=function(b){var c=a.ia.lc(b);a.Kb.Xca(c,b);return c.Bva};a.Kb.RY=function(b,c){b.FL||(b.FL={});b.FL[c]||(b.FL[c]=a.Uh.rQa());return b.FL[c]};a.Kb.FN=function(a,c){var e=null,f=a[c];if(null!=f){e=Object.keys(f)[0];f=f[e];if(null==e)throw"Invalid component descriptor key";switch(e){case "inline":e=Promise.resolve(f);
break;case "promise":e=f;break;default:throw"Invalid descriptor key "+e+" for the resource type: "+c;}}return e};a.Kb.oEa=function(){return c+g++};a.Kb.QHa=function(a){return window.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType};a.Kb.Vga=function(a){return 1===a.nodeType||3===a.nodeType};var g=0,c="_ojcomposite";a.vh={};a.vh.td={initializeMethod:"initialize",activatedMethod:"activated",attachedMethod:"attached",bindingsAppliedMethod:"bindingsApplied",detachedMethod:"detached",
disposeMethod:"dispose"};o_("Composite.defaults",a.vh.td,a);a.vh.getMetadata=function(b){return a.Kb.getMetadata(b)};o_("Composite.getMetadata",a.vh.getMetadata,a);a.vh.register=function(b,c){a.Kb.register(b,c)};o_("Composite.register",a.vh.register,a);a.vh.rna=function(b,c){for(var e=null;b;)if(b=a.Uh.bRa(b)){if(c&&!(b.compareDocumentPosition(c)&16))break;e=b}return e};a.vh.a$="__oj_composite"});